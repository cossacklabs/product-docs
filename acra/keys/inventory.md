---
weight: 1
title: Inventory of Acra keys
bookCollapseSection: true
---

# Inventory of Acra keys

There are several types of keys used in Acra:

  - **Storage asymmetric keys.**
    AcraWriter uses the public key to encrypt data to be stored in the database.
    AcraServer and AcraTranslator use corresponding private storage key
    to decrypt data queried from the database. Also AcraServer in 
    [Transparent proxy mode]({{< ref "/acra/configuring-maintaining/general-configuration/acra_server.md#transparent-proxy-mode-INVALID" >}}) and 
    AcraTranslator use public key to encrypt data using AcraWriter.
  - **Storage symmetric keys.**
    AcraServer in Transparent proxy mode and AcraTranslator use symmetric keys to encrypt/decrypt data with [AcraBlocks]({{< ref "acra/acra-in-depth/data-structures/#acrablock" >}})

  - **Blind index keys.**
    AcraServer in Transparent proxy mode and AcraTranslator uses symmetric keys for hash calculations to implement searchable encryption. More you can read in our [scientific paper](https://eprint.iacr.org/2019/806.pdf).

  - **Secure logging keys.**
    AcraServer, AcraConnector and AcraTranslator use symmetric keys for [audit log]({{< ref "/acra/security-controls/security-logging-and-events/#-INVALID" >}}) and HMAC calculations to sign all output logs

  - **Keys for transport encryption.**
    Acra uses either [Themis Secure Session](/themis/crypto-theory/cryptosystems/secure-session/) or TLS
    as transport protection between AcraServer and AcraConnector, or AcraTranslator and AcraConnector.

    In Themis Secure Session mode, Acra uses transport keypairs:
    the two parties should exchange public keys, keeping the private keys to themselves.
    In TLS mode, Acra uses TLS certificates instead of transport keypairs.

  - **Poison record keys.** Used by AcraServer and AcraTranslator to detect suspicious data access patterns.

  - **Authentication storage key.** Used by AcraServer for encryption/decryption credentials of AcraWebConfig users.

Storage keys can be represented by either:

  - One keypair for each *Client ID* ([default zone mode](https://docs.cossacklabs.com/pages/documentation-acra/#zones)),
    which is used for encryption by AcraWriter and decryption by AcraServer and AcraTranslator.

  - A set of *zone keys* ([multiple zone mode](https://docs.cossacklabs.com/pages/documentation-acra/#zones)).
    Each zone represents a unique user or type of users and has corresponding encryption and decryption keys.
    Using zones complicates unauthorized decryption:
    the attacker not only needs to get the decryption key but to use a correct Zone ID, too.

## Key names and locations

> Note: Read more about handling key names in [Losing your keys]({{< ref "/acra/keys/troubleshooting.md#losing-the-keys" >}}) and [Renaming your keys]({{< ref "/acra/keys/troubleshooting.md#renaming-key-files" >}}).

Each Acra component has to have its own key storage (by default it is key folder `.acrakeys`) that contains a set of keys necessary for the correct functioning of the components:

- **AcraConnector** needs to have its own transport private key and other party transport public key to establish a [Secure Session connection]({{< ref "themis/crypto-theory/cryptosystems/secure-session.md" >}}). You need put transport public key of AcraServer or AcraTranslator into AcraConnector's key storage, depending on the connection type.

- **AcraServer** needs to have:
    - AcraConnector's transport public key and AcraServer's own transport private key. This is necessary for accepting connections from clients via Secure Session
    - Storage and zone asymmetric private keys for decrypting AcraStructs generated by AcraWriter.
    - Storage symmetric keys for encrypting and decrypting AcraBlocks in transparent mode.
    - If AcraServer is running in [Transparent proxy mode]({{< ref "/acra/configuring-maintaining/general-configuration/acra_server.md#transparent-proxy-mode-INVALID" >}}), it should possess the zone and storage public key(s) for encrypting the values from SQL queries to AcraStructs and symmetric data encryption keys for AcraBlocks.
    - Poison record keys to be able to detect poison records in database responses.
    - Keys for secure logging that prevents tampering messages, removing, adding or changing the order of log entries
    - Authentication storage key to access AcraWebConfig's credentials and allow update AcraServer's configuration from WebUI.

- **AcraTranslator** needs to have same keys as AcraServer except authentication storage key.

- **AcraWriter** should have the storage public keys. They are necessary for encrypting data into AcraStructs in such a way that would only be readable for AcraServer/AcraTranslator.

- If you're using **AcraWebConfig** HTTP server to configure AcraServer remotely, the users' credentials are stored encrypted with authentication storage key and are decrypted on AcraServer upon users' login. AcraServer needs to have an authentication storage key.

#### Keys table

##### Asymmetric keys
| Purpose  | Private key  | Stays on  | Public key | Put to
| --- | --- | --- | --- | ---
| Transport AcraConnector | `${ClientID}` | AcraConnector | `${ClientID}.pub` | AcraServer<br/>AcraTranslator
| Transport AcraServer | `${ClientID}_server`| AcraServer | `${ClientID}_server.pub` | AcraConnector
| Transport AcraTranslator | `${ClientID}_translator`| AcraTranslator | `${ClientID}_translator.pub` | AcraConnector
| AcraStruct encryption |  |  | `${ClientID}_storage.pub` | AcraWriter<br/>AcraTranslator<br/>AcraServer (Transparent proxy mode)
| AcraStruct decryption | `${ClientID}_storage` | AcraServer<br/>AcraTranslator |  |  |
| AcraStruct encryption with Zones |  |  | `${ZoneID}_zone.pub` | AcraWriter<br/>AcraTranslator<br/>AcraServer (Transparent proxy mode)
| AcraStruct decryption with Zones | `${ZoneID}_zone` | AcraServer<br/>AcraTranslator | |
| Poison record with AcraStruct | `poison_key` | AcraServer<br/>AcrTranslator | `poison_key.pub` | AcraServer<br/>AcrTranslator

##### Symmetric keys
| Purpose  | Symmetric key  | Stays on
| --- | --- | --- 
| AcraBlock encryption + decryption | `${ClientID}_storage_sym` | AcraServer<br/>AcraTranslator
| AcraBlock encryption + decryption with Zones | `${ZoneID}_zone_sym` | AcraServer<br/>AcraTranslator
| Poison record with AcraBlock |  `${ZoneID}_zone_sym`| AcraServer<br/>AcraTranslator
| Searchable encryption + decryption |  `${ClientID}_hmac` | AcraServer<br/>AcraTranslator
| Secure logging |  `secure_log_key` | AcraServer<br/>AcraTranslator<br/>AcraConnector
| Authentication storage key for AcraWebConfig's users | `auth_key`| AcraServer

<!-- TODO: describe Acra EE keys? -->

Read about [key generation]({{< ref "acra/keys/operations/generation.md" >}})
to learn how to generate and distribute these keys between Acra components.
